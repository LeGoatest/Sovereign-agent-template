# .github/workflows/unzip-sagt.yml
name: Unzip sagt_.zip

on:
  workflow_dispatch:
  push:
    paths:
      - "sagt_.zip"

permissions:
  contents: write

jobs:
  unzip:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Install unzip
        run: sudo apt-get update && sudo apt-get install -y unzip

      - name: Unzip into root/ (overwrite allowed)
        run: |
          set -euo pipefail
          mkdir -p root
          rm -rf root/*
          unzip -o sagt_.zip -d root

          # If the zip contains a single top-level folder, flatten it:
          if [ "$(find root -mindepth 1 -maxdepth 1 -type d | wc -l | tr -d ' ')" = "1" ] && \
             [ "$(find root -mindepth 1 -maxdepth 1 -type f | wc -l | tr -d ' ')" = "0" ]; then
            top="$(find root -mindepth 1 -maxdepth 1 -type d | head -n 1)"
            shopt -s dotglob
            mv "$top"/* root/
            rmdir "$top"
          fi

      - name: Commit extracted contents
        run: |
          set -euo pipefail
          if git status --porcelain | grep -q .; then
            git config user.name "github-actions[bot]"
            git config user.email "github-actions[bot]@users.noreply.github.com"
            git add -A
            git commit -m "Unzip sagt_.zip into root/"
            git push
          else
            echo "No changes to commit."
          fi

